<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 将Mapper和对应的Dao绑定 -->
<mapper namespace="vip.doctordeng.bbs.dao.ForumDao">
	<sql id="defaultForumSql">
	forum_id,
	forum_name,
	forum_intruction,
	user_id,
	forum_parent_id,
	forum_status,
	prop1,
	prop2,
	prop3,
	prop4,
	prop5,
	prop6,
	prop7,
	prop8,
	prop9,
	prop10
	</sql>
	<sql id="insertForumSql">
	forum_name,
	forum_intruction,
	forum_parent_id,
	prop1,
	prop2,
	prop3,
	prop4,
	prop5,
	prop6,
	prop7,
	prop8,
	prop9,
	prop10
	</sql>
	<sql id="defaultForumStatusSql">
		forum_status = 0
	</sql>

	<insert id="insertForum" parameterType="formModule">
		INSERT INTO forum (<include refid="insertForumSql" />)
		VALUES(
			#{forum_name},
			#{forum_intruction},
			#{forum_parent_id},
			#{prop1},
			#{prop2},
			#{prop3},
			#{prop4},
			#{prop5},
			#{prop6},
			#{prop7},
			#{prop8},
			#{prop9},
			#{prop10}
		)
	</insert>
	
	<update id="updateForumByCondition" parameterType="Map">
		UPDATE forum 
		 <set>
     		 <if test="forum_name != null and forum_name != '' ">forum_name=#{forum_name},</if>
      		 <if test="forum_intruction != null">forum_intruction=#{forum_intruction},</if>
      		 <if test="user_id != null and user_id != '' ">user_id=#{user_id},</if>
      		 <if test="forum_status != null and forum_status != '' ">forum_status=#{forum_status},</if>
      		 <if test="prop1 != null">prop1=#{prop1},</if>
      		 <if test="prop2 != null">prop2=#{prop2},</if>
      		 <if test="prop3 != null">prop3=#{prop3},</if>
      		 <if test="prop4 != null">prop4=#{prop4},</if>
      		 <if test="prop5 != null">prop5=#{prop5},</if>
      		 <if test="prop6 != null">prop6=#{prop6},</if>
      		 <if test="prop7 != null">prop7=#{prop7},</if>
      		 <if test="prop8 != null">prop8=#{prop8},</if>
      		 <if test="prop9 != null">prop9=#{prop9},</if>
      		 <if test="prop10 != null">prop10=#{prop10}</if>
   		 </set>
   		 WHERE forum_id = #{forum_id}
	</update>

	<select id="listForumByCondition" parameterType="Map"
		resultType="formModule">
		SELECT
		<include refid="defaultForumSql" />
		FROM forum
		<where>
			<choose>
				<when test="searchWay == 'listUserForum' ">
					AND user_id = #{user_id}
					AND
					<include refid="defaultForumStatusSql" />
				</when>
				<when test="searchWay == 'listAllForum' ">
					AND
					<include refid="defaultForumStatusSql" />
				</when>
				<when test="searchWay == 'listForumChild' ">
					AND forum_parent_id = #{forum_id}
					AND
					<include refid="defaultForumStatusSql" />
				</when>
				<when test="seachWay == 'listForumAndChild' ">
					AND forum_parent_id = #{forum_id}
					OR forum_id = #{forum_id}
				</when>
				<when test="seachWay == '' or searchWay == null">
					AND forum_id = 0
				</when>
				<!-- <when test="searchWay == 'listInvalidForum' "> </when> -->
			</choose>
		</where>
	</select>
</mapper>